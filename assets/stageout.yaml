cwlVersion: v1.0
class: CommandLineTool
id: stage-out
doc: "Stage-out the results to S3"
#hints:
#  "cwltool:Secrets":
#    secrets:
#      - STAGEOUT_AWS_ACCESS_KEY_ID
#      - STAGEOUT_AWS_SECRET_ACCESS_KEY
#      - STAGEOUT_AWS_REGION
#      - STAGEOUT_AWS_SERVICEURL
inputs:
  STAGEOUT_OUTPUT:
    type: string
  process:
    type: string
  STAGEOUT_AWS_ACCESS_KEY_ID:
    type: string
  STAGEOUT_AWS_SECRET_ACCESS_KEY:
    type: string
  STAGEOUT_AWS_REGION:
    type: string
  STAGEOUT_AWS_SERVICEURL:
    type: string
outputs:
  StacCatalogUri:
    outputBinding:
      outputEval: ${  return inputs.STAGEOUT_OUTPUT + "/" + inputs.process + "/catalog.json"; }
    type: string
baseCommand:
  - echo
arguments:
  - $( inputs.wf_outputs.path )
  - $( inputs.STAGEOUT_OUTPUT )
  - $( inputs.process )
requirements:
  DockerRequirement:
    dockerPull: ghcr.io/terradue/ogc-eo-application-package-hands-on/stage:1.3.2
  InlineJavascriptRequirement: {}
  EnvVarRequirement:
    envDef:
      STAGEOUT_AWS_ACCESS_KEY_ID: $( inputs.STAGEOUT_AWS_ACCESS_KEY_ID )
      STAGEOUT_AWS_SECRET_ACCESS_KEY: $( inputs.STAGEOUT_AWS_SECRET_ACCESS_KEY )
      STAGEOUT_AWS_REGION: $( inputs.STAGEOUT_AWS_REGION )
      STAGEOUT_AWS_SERVICEURL: $( inputs.STAGEOUT_AWS_SERVICEURL )

  ResourceRequirement: {}
  InitialWorkDirRequirement:
    listing:
      - entryname: stage.py
        entry: |-
          import os
          import sys
          sys.exit(0)
